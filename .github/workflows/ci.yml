name: 'integration'

on:
  - workflow_dispatch

jobs:
  trigger:
    name: "Call repository_dispach"
    runs-on: [self-hosted,Linux,X64]
    steps:
    - uses: actions/checkout@v3
    
    - uses: passeidireto/trigger-external-workflow-action@main
      with:
        repository: kamoteam/app1
        event: trigger
        github_pat: ${{ secrets.PAT }}

    - uses: passeidireto/trigger-external-workflow-action@main
      with:
        repository: kamoteam/app1
        event: trigger
        github_pat: ${{ secrets.PAT }}

  wait:
    name: "Wait trigger jobs"
    runs-on: [self-hosted,Linux,X64]
    steps:
    - uses: actions/checkout@v3

    - name: Wait for tests to succeed
      uses: lewagon/wait-on-check-action@v1.0.0
      with:
        ref: ${{ github.ref }}
        check-name: 'Run tests'
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        wait-interval: 10
